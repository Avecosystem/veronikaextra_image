
import {createRequire as ___nfyCreateRequire} from "module";
import {fileURLToPath as ___nfyFileURLToPath} from "url";
import {dirname as ___nfyPathDirname} from "path";
let __filename=___nfyFileURLToPath(import.meta.url);
let __dirname=___nfyPathDirname(___nfyFileURLToPath(import.meta.url));
let require=___nfyCreateRequire(import.meta.url);


// utils/apiUtils.ts
function formatApiError(error) {
  if (error.name === "AbortError") {
    return "The request timed out. Please try again later.";
  }
  if (error instanceof TypeError && error.message.includes("fetch")) {
    if (error.message.includes("a4f.co")) {
      return "Failed to connect to the image generation service. Please check your internet connection and try again.";
    }
    return "Failed to connect to the image generation service. Please check your internet connection and try again.";
  }
  if (error.message) {
    const message = error.message.toLowerCase();
    if (message.includes("429") || message.includes("rate limit") || message.includes("concurrency") || message.includes("busy")) {
      return "Server is busy, kindly wait. Try again later";
    }
    return error.message;
  }
  return "An unknown error occurred. Please try again later.";
}

// netlify/functions/generate-images.ts
async function handler(request, context) {
  const headers = {
    "Access-Control-Allow-Credentials": "true",
    "Access-Control-Allow-Origin": "*",
    "Access-Control-Allow-Methods": "GET,OPTIONS,PATCH,DELETE,POST,PUT",
    "Access-Control-Allow-Headers": "X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version",
    "Content-Type": "application/json"
  };
  if (request.method === "OPTIONS") {
    return new Response("", { status: 200, headers });
  }
  if (request.method !== "POST") {
    return new Response(JSON.stringify({ message: "Method Not Allowed" }), { status: 405, headers });
  }
  const apiKey = process.env.NEW_API_KEY || process.env.API_KEY;
  const model = process.env.PROVIDER_MODEL || "provider-4/imagen-3.5";
  console.log("\u{1F50D} Environment variables check:");
  console.log("  NEW_API_KEY:", process.env.NEW_API_KEY ? `${process.env.NEW_API_KEY.substring(0, 8)}...${process.env.NEW_API_KEY.substring(process.env.NEW_API_KEY.length - 4)}` : "Not set");
  console.log("  API_KEY:", process.env.API_KEY ? `${process.env.API_KEY.substring(0, 8)}...${process.env.API_KEY.substring(process.env.API_KEY.length - 4)}` : "Not set");
  console.log("  PROVIDER_MODEL:", process.env.PROVIDER_MODEL);
  console.log("  API_ENDPOINT:", process.env.API_ENDPOINT);
  if (!apiKey) {
    console.error("CRITICAL: API_KEY missing in server environment.");
    return new Response(JSON.stringify({
      message: "Server Configuration Error: API Key is missing. Please add API_KEY to environment settings."
    }), { status: 500, headers });
  }
  try {
    const bodyData = await request.json().catch(() => null);
    if (!bodyData) {
      return new Response(JSON.stringify({ message: "Invalid request body" }), { status: 400, headers });
    }
    const { prompt, numberOfImages = 1 } = bodyData;
    const validImageCount = Math.max(1, Math.min(6, numberOfImages));
    if (!prompt) {
      return new Response(JSON.stringify({ message: "Prompt is required" }), { status: 400, headers });
    }
    const apiUrl = process.env.API_ENDPOINT || "https://api.a4f.co/v1/images/generations";
    console.log(`\u{1F50D} Using endpoint: ${apiUrl}`);
    console.log(`\u{1F3A8} Generating ${validImageCount} images in parallel`);
    const payload = {
      model,
      prompt,
      n: 1,
      size: "1024x1024"
    };
    console.log("\u{1F4E4} Sending payload:", JSON.stringify(payload, null, 2));
    const imagePromises = Array.from({ length: validImageCount }, async (_, i) => {
      try {
        console.log(`\u{1F510} Generating image ${i + 1} of ${validImageCount}`);
        const headers2 = {
          "Authorization": `Bearer ${apiKey}`,
          "Content-Type": "application/json"
        };
        const response = await fetchWithTimeout(apiUrl, {
          method: "POST",
          headers: headers2,
          body: JSON.stringify(payload)
        }, 25e3);
        if (!response.ok) {
          let errorMessage = `HTTP Error: ${response.status} ${response.statusText}`;
          try {
            const errorData = await response.json();
            errorMessage = errorData.error?.message || errorData.message || errorMessage;
            console.error(`Full API error response for image ${i + 1}:`, errorData);
          } catch (e) {
            console.error("Could not parse error response:", e);
          }
          throw new Error(`Error generating image ${i + 1}: ${errorMessage}`);
        }
        console.log(`\u2705 Image ${i + 1} generated successfully`);
        const data = await response.json();
        console.log(`\u{1F50E} API raw response for image ${i + 1}:`, JSON.stringify(data));
        if (data && data.data && Array.isArray(data.data) && data.data.length > 0) {
          const item = data.data[0];
          return {
            id: `img-${Date.now()}-${i}`,
            url: item.url || item.b64_json,
            prompt
          };
        }
        if (data && data.image && (data.image.url || data.image.b64_json)) {
          return {
            id: `img-${Date.now()}-${i}`,
            url: data.image.url || data.image.b64_json,
            prompt
          };
        }
        if (data && data.url) {
          return {
            id: `img-${Date.now()}-${i}`,
            url: data.url,
            prompt
          };
        }
        if (data && data.images && Array.isArray(data.images) && data.images.length > 0) {
          const item = data.images[0];
          return {
            id: `img-${Date.now()}-${i}`,
            url: item.url || item.b64_json || item,
            prompt
          };
        }
        return null;
      } catch (error) {
        console.error(`Failed to generate image ${i + 1}:`, error.message);
        return null;
      }
    });
    const results = await Promise.all(imagePromises);
    const images = results.filter((img) => img !== null);
    if (images.length === 0) {
      throw new Error("No images generated. Please try a different prompt.");
    }
    return new Response(JSON.stringify({ images }), { status: 200, headers });
  } catch (error) {
    console.error("Backend Generation Error:", error);
    const formattedError = formatApiError(error);
    console.error("Debug Info:");
    console.error("  - API Key Present:", !!apiKey);
    console.error("  - Model:", model);
    console.error("  - Endpoint:", process.env.API_ENDPOINT || "https://api.a4f.co/v1/images/generations");
    return new Response(JSON.stringify({
      message: formattedError,
      debugInfo: {
        apiKeyPresent: !!apiKey,
        model,
        endpoint: process.env.API_ENDPOINT || "https://api.a4f.co/v1/images/generations"
      }
    }), { status: 500, headers });
  }
}
async function fetchWithTimeout(url, options, timeoutMs = 3e4) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    clearTimeout(timeoutId);
    throw error;
  }
}
export {
  handler as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsidXRpbHMvYXBpVXRpbHMudHMiLCAibmV0bGlmeS9mdW5jdGlvbnMvZ2VuZXJhdGUtaW1hZ2VzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvLyB1dGlscy9hcGlVdGlscy50c1xyXG4vKipcclxuICogVXRpbGl0eSBmdW5jdGlvbnMgZm9yIEFQSSBoYW5kbGluZyBhbmQgdmFsaWRhdGlvblxyXG4gKi9cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUFwaUNvbmZpZ3VyYXRpb24oKTogeyBpc1ZhbGlkOiBib29sZWFuOyBlcnJvck1lc3NhZ2U/OiBzdHJpbmcgfSB7XHJcbiAgLy8gQ2hlY2sgaWYgd2UncmUgaW4gYSBicm93c2VyIGVudmlyb25tZW50XHJcbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAvLyBDbGllbnQtc2lkZSB2YWxpZGF0aW9uIC0gdHJ5IG11bHRpcGxlIHBvc3NpYmxlIGVudmlyb25tZW50IHZhcmlhYmxlIHNvdXJjZXNcclxuICAgIGxldCBhcGlLZXk7XHJcbiAgICBcclxuICAgIC8vIEB0cy1pZ25vcmU6IEltcG9ydE1ldGEgaW50ZXJmYWNlIGV4dGVuc2lvblxyXG4gICAgaWYgKHR5cGVvZiBpbXBvcnQubWV0YSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1wb3J0Lm1ldGEuZW52KSB7XHJcbiAgICAgIC8vIEB0cy1pZ25vcmU6IEltcG9ydE1ldGEgaW50ZXJmYWNlIGV4dGVuc2lvblxyXG4gICAgICBhcGlLZXkgPSBpbXBvcnQubWV0YS5lbnYuTkVXX0FQSV9LRVkgfHwgaW1wb3J0Lm1ldGEuZW52LlZJVEVfTkVXX0FQSV9LRVk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEZhbGxiYWNrIHRvIHdpbmRvdy5wcm9jZXNzIGlmIGF2YWlsYWJsZVxyXG4gICAgaWYgKCFhcGlLZXkgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgKHdpbmRvdyBhcyBhbnkpLnByb2Nlc3M/LmVudikge1xyXG4gICAgICBhcGlLZXkgPSAod2luZG93IGFzIGFueSkucHJvY2Vzcz8uZW52Lk5FV19BUElfS0VZIHx8ICh3aW5kb3cgYXMgYW55KS5wcm9jZXNzPy5lbnYuVklURV9ORVdfQVBJX0tFWTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKCFhcGlLZXkpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcclxuICAgICAgICBlcnJvck1lc3NhZ2U6IFwiQVBJIGtleSBpcyBtaXNzaW5nLiBQbGVhc2UgY29uZmlndXJlIHlvdXIgQVBJIGtleSBpbiB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGVzLlwiXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfSBlbHNlIGlmICh0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgJiYgcHJvY2Vzcy5lbnYpIHtcclxuICAgIC8vIFNlcnZlci1zaWRlIHZhbGlkYXRpb25cclxuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52Lk5FV19BUElfS0VZIHx8IHByb2Nlc3MuZW52LkFQSV9LRVk7XHJcbiAgICBpZiAoIWFwaUtleSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yTWVzc2FnZTogXCJBUEkga2V5IGlzIG1pc3NpbmcuIFBsZWFzZSBjb25maWd1cmUgeW91ciBBUEkga2V5IGluIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMuXCJcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiB7IGlzVmFsaWQ6IHRydWUgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEFwaUVuZHBvaW50KCk6IHN0cmluZyB7XHJcbiAgLy8gQ2hlY2sgaWYgd2UncmUgaW4gYSBicm93c2VyIGVudmlyb25tZW50XHJcbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAvLyBAdHMtaWdub3JlOiBJbXBvcnRNZXRhIGludGVyZmFjZSBleHRlbnNpb25cclxuICAgIGxldCBjdXN0b21FbmRwb2ludDtcclxuICAgIC8vIEB0cy1pZ25vcmU6IEltcG9ydE1ldGEgaW50ZXJmYWNlIGV4dGVuc2lvblxyXG4gICAgaWYgKHR5cGVvZiBpbXBvcnQubWV0YSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1wb3J0Lm1ldGEuZW52KSB7XHJcbiAgICAgIC8vIEB0cy1pZ25vcmU6IEltcG9ydE1ldGEgaW50ZXJmYWNlIGV4dGVuc2lvblxyXG4gICAgICBjdXN0b21FbmRwb2ludCA9IGltcG9ydC5tZXRhLmVudi5BUElfRU5EUE9JTlQgfHwgaW1wb3J0Lm1ldGEuZW52LlZJVEVfQVBJX0VORFBPSU5UO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBGYWxsYmFjayB0byB3aW5kb3cucHJvY2VzcyBpZiBhdmFpbGFibGVcclxuICAgIGlmICghY3VzdG9tRW5kcG9pbnQgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgKHdpbmRvdyBhcyBhbnkpLnByb2Nlc3M/LmVudikge1xyXG4gICAgICBjdXN0b21FbmRwb2ludCA9ICh3aW5kb3cgYXMgYW55KS5wcm9jZXNzPy5lbnYuQVBJX0VORFBPSU5UIHx8ICh3aW5kb3cgYXMgYW55KS5wcm9jZXNzPy5lbnYuVklURV9BUElfRU5EUE9JTlQ7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmIChjdXN0b21FbmRwb2ludCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhgXHVEODNEXHVERDI3IFVzaW5nIGN1c3RvbSBlbmRwb2ludCBmcm9tIGVudmlyb25tZW50OiAke2N1c3RvbUVuZHBvaW50fWApO1xyXG4gICAgICByZXR1cm4gY3VzdG9tRW5kcG9pbnQ7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEdldCB0aGUgbW9kZWwgdG8gZGV0ZXJtaW5lIHRoZSBjb3JyZWN0IGVuZHBvaW50XHJcbiAgICBsZXQgbW9kZWw7XHJcbiAgICAvLyBAdHMtaWdub3JlOiBJbXBvcnRNZXRhIGludGVyZmFjZSBleHRlbnNpb25cclxuICAgIGlmICh0eXBlb2YgaW1wb3J0Lm1ldGEgIT09ICd1bmRlZmluZWQnICYmIGltcG9ydC5tZXRhLmVudikge1xyXG4gICAgICAvLyBAdHMtaWdub3JlOiBJbXBvcnRNZXRhIGludGVyZmFjZSBleHRlbnNpb25cclxuICAgICAgbW9kZWwgPSBpbXBvcnQubWV0YS5lbnYuUFJPVklERVJfTU9ERUwgfHwgaW1wb3J0Lm1ldGEuZW52LlZJVEVfUFJPVklERVJfTU9ERUw7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEZhbGxiYWNrIHRvIHdpbmRvdy5wcm9jZXNzIGlmIGF2YWlsYWJsZVxyXG4gICAgaWYgKCFtb2RlbCAmJiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiAod2luZG93IGFzIGFueSkucHJvY2Vzcz8uZW52KSB7XHJcbiAgICAgIG1vZGVsID0gKHdpbmRvdyBhcyBhbnkpLnByb2Nlc3M/LmVudi5QUk9WSURFUl9NT0RFTCB8fCAod2luZG93IGFzIGFueSkucHJvY2Vzcz8uZW52LlZJVEVfUFJPVklERVJfTU9ERUw7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIENoZWNrIGlmIGl0J3MgcHJvdmlkZXItNC9pbWFnZW4tMy41XHJcbiAgICBpZiAobW9kZWwgJiYgKG1vZGVsLmluY2x1ZGVzKCdwcm92aWRlci00JykgfHwgbW9kZWwuaW5jbHVkZXMoJ2ltYWdlbi0zLjUnKSkpIHtcclxuICAgICAgLy8gVXNlIHRoZSBjb3JyZWN0IGVuZHBvaW50IGZvciBhNGYuY29cclxuICAgICAgcmV0dXJuIFwiaHR0cHM6Ly9hcGkuYTRmLmNvL3YxL2ltYWdlcy9nZW5lcmF0aW9uc1wiO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvLyBTZXJ2ZXItc2lkZSBvciBmYWxsYmFja1xyXG4gIGNvbnN0IGN1c3RvbUVuZHBvaW50ID0gcHJvY2Vzcy5lbnYuQVBJX0VORFBPSU5UO1xyXG4gIGlmIChjdXN0b21FbmRwb2ludCkge1xyXG4gICAgY29uc29sZS5sb2coYFx1RDgzRFx1REQyNyBVc2luZyBjdXN0b20gZW5kcG9pbnQgZnJvbSBlbnZpcm9ubWVudDogJHtjdXN0b21FbmRwb2ludH1gKTtcclxuICAgIHJldHVybiBjdXN0b21FbmRwb2ludDtcclxuICB9XHJcbiAgXHJcbiAgLy8gR2V0IHRoZSBtb2RlbCB0byBkZXRlcm1pbmUgdGhlIGNvcnJlY3QgZW5kcG9pbnRcclxuICBjb25zdCBtb2RlbCA9IHByb2Nlc3MuZW52LlBST1ZJREVSX01PREVMIHx8IFwicHJvdmlkZXItNC9pbWFnZW4tMy41XCI7XHJcbiAgXHJcbiAgLy8gQ2hlY2sgaWYgaXQncyBwcm92aWRlci00L2ltYWdlbi0zLjVcclxuICBpZiAobW9kZWwgJiYgKG1vZGVsLmluY2x1ZGVzKCdwcm92aWRlci00JykgfHwgbW9kZWwuaW5jbHVkZXMoJ2ltYWdlbi0zLjUnKSkpIHtcclxuICAgIC8vIFVzZSB0aGUgY29ycmVjdCBlbmRwb2ludCBmb3IgYTRmLmNvXHJcbiAgICByZXR1cm4gXCJodHRwczovL2FwaS5hNGYuY28vdjEvaW1hZ2VzL2dlbmVyYXRpb25zXCI7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIERlZmF1bHQgZmFsbGJhY2tcclxuICByZXR1cm4gXCJodHRwczovL2FwaS5hNGYuY28vdjEvaW1hZ2VzL2dlbmVyYXRpb25zXCI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0FwaUVuZHBvaW50VmFsaWQoZW5kcG9pbnQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gIC8vIEJhc2ljIHZhbGlkYXRpb24gZm9yIEFQSSBlbmRwb2ludFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGVuZHBvaW50KTtcclxuICAgIHJldHVybiB1cmwucHJvdG9jb2wgPT09ICdodHRwczonO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB0ZXN0RW5kcG9pbnRDb25uZWN0aXZpdHkoZW5kcG9pbnQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBTaW1wbGUgSEVBRCByZXF1ZXN0IHRvIHRlc3QgY29ubmVjdGl2aXR5XHJcbiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xyXG4gICAgY29uc3QgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0KCksIDUwMDApOyAvLyA1IHNlY29uZCB0aW1lb3V0XHJcbiAgICBcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZW5kcG9pbnQsIHtcclxuICAgICAgbWV0aG9kOiAnSEVBRCcsXHJcbiAgICAgIHNpZ25hbDogY29udHJvbGxlci5zaWduYWxcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcclxuICAgIHJldHVybiByZXNwb25zZS5vaztcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdEFwaUVycm9yKGVycm9yOiBhbnkpOiBzdHJpbmcge1xyXG4gIC8vIEhhbmRsZSBkaWZmZXJlbnQgdHlwZXMgb2YgQVBJIGVycm9yc1xyXG4gIGlmIChlcnJvci5uYW1lID09PSAnQWJvcnRFcnJvcicpIHtcclxuICAgIHJldHVybiBcIlRoZSByZXF1ZXN0IHRpbWVkIG91dC4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIjtcclxuICB9XHJcbiAgXHJcbiAgaWYgKGVycm9yIGluc3RhbmNlb2YgVHlwZUVycm9yICYmIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ2ZldGNoJykpIHtcclxuICAgIC8vIENoZWNrIGlmIGl0J3MgYSBjb25uZWN0aW9uIGVycm9yIHRvIHRoZSBhNGYuY28gZW5kcG9pbnRcclxuICAgIGlmIChlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdhNGYuY28nKSkge1xyXG4gICAgICByZXR1cm4gXCJGYWlsZWQgdG8gY29ubmVjdCB0byB0aGUgaW1hZ2UgZ2VuZXJhdGlvbiBzZXJ2aWNlLiBQbGVhc2UgY2hlY2sgeW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGFuZCB0cnkgYWdhaW4uXCI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gXCJGYWlsZWQgdG8gY29ubmVjdCB0byB0aGUgaW1hZ2UgZ2VuZXJhdGlvbiBzZXJ2aWNlLiBQbGVhc2UgY2hlY2sgeW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGFuZCB0cnkgYWdhaW4uXCI7XHJcbiAgfVxyXG4gIFxyXG4gIGlmIChlcnJvci5tZXNzYWdlKSB7XHJcbiAgICAvLyBIYW5kbGUgcmF0ZSBsaW1pdGluZyBhbmQgY29uY3VycmVuY3kgZXJyb3JzIHdpdGggdXNlci1mcmllbmRseSBtZXNzYWdlXHJcbiAgICBjb25zdCBtZXNzYWdlID0gZXJyb3IubWVzc2FnZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJzQyOScpIHx8IFxyXG4gICAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoJ3JhdGUgbGltaXQnKSB8fFxyXG4gICAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoJ2NvbmN1cnJlbmN5JykgfHxcclxuICAgICAgICBtZXNzYWdlLmluY2x1ZGVzKCdidXN5JykpIHtcclxuICAgICAgcmV0dXJuIFwiU2VydmVyIGlzIGJ1c3ksIGtpbmRseSB3YWl0LiBUcnkgYWdhaW4gbGF0ZXJcIjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiBcIkFuIHVua25vd24gZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCI7XHJcbn0iLCAiaW1wb3J0IHsgZm9ybWF0QXBpRXJyb3IgfSBmcm9tICcuLi8uLi91dGlscy9hcGlVdGlscyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcXVlc3Q6IFJlcXVlc3QsIGNvbnRleHQ6IGFueSkge1xyXG4gICAgY29uc3QgaGVhZGVycyA9IHtcclxuICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHMnOiAndHJ1ZScsXHJcbiAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJyxcclxuICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctTWV0aG9kcyc6ICdHRVQsT1BUSU9OUyxQQVRDSCxERUxFVEUsUE9TVCxQVVQnLFxyXG4gICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJzogJ1gtQ1NSRi1Ub2tlbiwgWC1SZXF1ZXN0ZWQtV2l0aCwgQWNjZXB0LCBBY2NlcHQtVmVyc2lvbiwgQ29udGVudC1MZW5ndGgsIENvbnRlbnQtTUQ1LCBDb250ZW50LVR5cGUsIERhdGUsIFgtQXBpLVZlcnNpb24nLFxyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgIH07XHJcblxyXG4gICAgaWYgKHJlcXVlc3QubWV0aG9kID09PSAnT1BUSU9OUycpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKCcnLCB7IHN0YXR1czogMjAwLCBoZWFkZXJzIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXF1ZXN0Lm1ldGhvZCAhPT0gJ1BPU1QnKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6ICdNZXRob2QgTm90IEFsbG93ZWQnIH0pLCB7IHN0YXR1czogNDA1LCBoZWFkZXJzIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDIuIFZhbGlkYXRlIEFQSSBLZXkgZnJvbSBTZXJ2ZXIgRW52aXJvbm1lbnRcclxuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52Lk5FV19BUElfS0VZIHx8IHByb2Nlc3MuZW52LkFQSV9LRVk7XHJcbiAgICBjb25zdCBtb2RlbCA9IHByb2Nlc3MuZW52LlBST1ZJREVSX01PREVMIHx8IFwicHJvdmlkZXItNC9pbWFnZW4tMy41XCI7XHJcblxyXG4gICAgLy8gQWRkIGRlYnVnZ2luZyB0byBzZWUgd2hhdCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYXJlIGF2YWlsYWJsZVxyXG4gICAgY29uc29sZS5sb2coXCJcdUQ4M0RcdUREMEQgRW52aXJvbm1lbnQgdmFyaWFibGVzIGNoZWNrOlwiKTtcclxuICAgIGNvbnNvbGUubG9nKFwiICBORVdfQVBJX0tFWTpcIiwgcHJvY2Vzcy5lbnYuTkVXX0FQSV9LRVkgPyBgJHtwcm9jZXNzLmVudi5ORVdfQVBJX0tFWS5zdWJzdHJpbmcoMCwgOCl9Li4uJHtwcm9jZXNzLmVudi5ORVdfQVBJX0tFWS5zdWJzdHJpbmcocHJvY2Vzcy5lbnYuTkVXX0FQSV9LRVkubGVuZ3RoIC0gNCl9YCA6ICdOb3Qgc2V0Jyk7XHJcbiAgICBjb25zb2xlLmxvZyhcIiAgQVBJX0tFWTpcIiwgcHJvY2Vzcy5lbnYuQVBJX0tFWSA/IGAke3Byb2Nlc3MuZW52LkFQSV9LRVkuc3Vic3RyaW5nKDAsIDgpfS4uLiR7cHJvY2Vzcy5lbnYuQVBJX0tFWS5zdWJzdHJpbmcocHJvY2Vzcy5lbnYuQVBJX0tFWS5sZW5ndGggLSA0KX1gIDogJ05vdCBzZXQnKTtcclxuICAgIGNvbnNvbGUubG9nKFwiICBQUk9WSURFUl9NT0RFTDpcIiwgcHJvY2Vzcy5lbnYuUFJPVklERVJfTU9ERUwpO1xyXG4gICAgY29uc29sZS5sb2coXCIgIEFQSV9FTkRQT0lOVDpcIiwgcHJvY2Vzcy5lbnYuQVBJX0VORFBPSU5UKTtcclxuXHJcbiAgICBpZiAoIWFwaUtleSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDUklUSUNBTDogQVBJX0tFWSBtaXNzaW5nIGluIHNlcnZlciBlbnZpcm9ubWVudC5cIik7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgQ29uZmlndXJhdGlvbiBFcnJvcjogQVBJIEtleSBpcyBtaXNzaW5nLiBQbGVhc2UgYWRkIEFQSV9LRVkgdG8gZW52aXJvbm1lbnQgc2V0dGluZ3MuJ1xyXG4gICAgICAgIH0pLCB7IHN0YXR1czogNTAwLCBoZWFkZXJzIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgYm9keURhdGEgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKS5jYXRjaCgoKSA9PiBudWxsKTtcclxuICAgICAgICBpZiAoIWJvZHlEYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiAnSW52YWxpZCByZXF1ZXN0IGJvZHknIH0pLCB7IHN0YXR1czogNDAwLCBoZWFkZXJzIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgeyBwcm9tcHQsIG51bWJlck9mSW1hZ2VzID0gMSB9ID0gYm9keURhdGE7XHJcblxyXG4gICAgICAgIC8vIFZhbGlkYXRlIG51bWJlciBvZiBpbWFnZXMgKDEtNilcclxuICAgICAgICBjb25zdCB2YWxpZEltYWdlQ291bnQgPSBNYXRoLm1heCgxLCBNYXRoLm1pbig2LCBudW1iZXJPZkltYWdlcykpO1xyXG5cclxuICAgICAgICBpZiAoIXByb21wdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogJ1Byb21wdCBpcyByZXF1aXJlZCcgfSksIHsgc3RhdHVzOiA0MDAsIGhlYWRlcnMgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBBUEkgZW5kcG9pbnQgLSBwcmlvcml0aXplIGN1c3RvbSBlbmRwb2ludCBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlc1xyXG4gICAgICAgIGNvbnN0IGFwaVVybCA9IHByb2Nlc3MuZW52LkFQSV9FTkRQT0lOVCB8fCBcImh0dHBzOi8vYXBpLmE0Zi5jby92MS9pbWFnZXMvZ2VuZXJhdGlvbnNcIjtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coYFx1RDgzRFx1REQwRCBVc2luZyBlbmRwb2ludDogJHthcGlVcmx9YCk7XHJcblxyXG4gICAgICAgIC8vIEdlbmVyYXRlIGFsbCBpbWFnZXMgaW4gcGFyYWxsZWwgZm9yIGJldHRlciBwZXJmb3JtYW5jZVxyXG4gICAgICAgIGNvbnNvbGUubG9nKGBcdUQ4M0NcdURGQTggR2VuZXJhdGluZyAke3ZhbGlkSW1hZ2VDb3VudH0gaW1hZ2VzIGluIHBhcmFsbGVsYCk7XHJcblxyXG4gICAgICAgIC8vIFByZXBhcmUgdGhlIHJlcXVlc3QgcGF5bG9hZCAoYWx3YXlzIGdlbmVyYXRlIDEgaW1hZ2UgcGVyIHJlcXVlc3QpXHJcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcclxuICAgICAgICAgICAgbW9kZWw6IG1vZGVsLFxyXG4gICAgICAgICAgICBwcm9tcHQ6IHByb21wdCxcclxuICAgICAgICAgICAgbjogMSxcclxuICAgICAgICAgICAgc2l6ZTogXCIxMDI0eDEwMjRcIlxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdcdUQ4M0RcdURDRTQgU2VuZGluZyBwYXlsb2FkOicsIEpTT04uc3RyaW5naWZ5KHBheWxvYWQsIG51bGwsIDIpKTtcclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIGFuIGFycmF5IG9mIHByb21pc2VzIGZvciBwYXJhbGxlbCBleGVjdXRpb25cclxuICAgICAgICBjb25zdCBpbWFnZVByb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogdmFsaWRJbWFnZUNvdW50IH0sIGFzeW5jIChfLCBpKSA9PiB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgXHVEODNEXHVERDEwIEdlbmVyYXRpbmcgaW1hZ2UgJHtpICsgMX0gb2YgJHt2YWxpZEltYWdlQ291bnR9YCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHthcGlLZXl9YCxcclxuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2hXaXRoVGltZW91dChhcGlVcmwsIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpXHJcbiAgICAgICAgICAgICAgICB9LCAyNTAwMCk7IC8vIDI1IHNlY29uZCB0aW1lb3V0IHBlciByZXF1ZXN0XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBgSFRUUCBFcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3JEYXRhLmVycm9yPy5tZXNzYWdlIHx8IGVycm9yRGF0YS5tZXNzYWdlIHx8IGVycm9yTWVzc2FnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRnVsbCBBUEkgZXJyb3IgcmVzcG9uc2UgZm9yIGltYWdlICR7aSArIDF9OmAsIGVycm9yRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ291bGQgbm90IHBhcnNlIGVycm9yIHJlc3BvbnNlOlwiLCBlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBnZW5lcmF0aW5nIGltYWdlICR7aSArIDF9OiAke2Vycm9yTWVzc2FnZX1gKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgXHUyNzA1IEltYWdlICR7aSArIDF9IGdlbmVyYXRlZCBzdWNjZXNzZnVsbHlgKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgXHVEODNEXHVERDBFIEFQSSByYXcgcmVzcG9uc2UgZm9yIGltYWdlICR7aSArIDF9OmAsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmRhdGEgJiYgQXJyYXkuaXNBcnJheShkYXRhLmRhdGEpICYmIGRhdGEuZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGRhdGEuZGF0YVswXTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogYGltZy0ke0RhdGUubm93KCl9LSR7aX1gLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGl0ZW0udXJsIHx8IGl0ZW0uYjY0X2pzb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21wdDogcHJvbXB0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEuaW1hZ2UgJiYgKGRhdGEuaW1hZ2UudXJsIHx8IGRhdGEuaW1hZ2UuYjY0X2pzb24pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGBpbWctJHtEYXRlLm5vdygpfS0ke2l9YCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBkYXRhLmltYWdlLnVybCB8fCBkYXRhLmltYWdlLmI2NF9qc29uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IHByb21wdFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnVybCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBgaW1nLSR7RGF0ZS5ub3coKX0tJHtpfWAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZGF0YS51cmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21wdDogcHJvbXB0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEuaW1hZ2VzICYmIEFycmF5LmlzQXJyYXkoZGF0YS5pbWFnZXMpICYmIGRhdGEuaW1hZ2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gZGF0YS5pbWFnZXNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGBpbWctJHtEYXRlLm5vdygpfS0ke2l9YCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBpdGVtLnVybCB8fCBpdGVtLmI2NF9qc29uIHx8IGl0ZW0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21wdDogcHJvbXB0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZ2VuZXJhdGUgaW1hZ2UgJHtpICsgMX06YCwgZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsgLy8gUmV0dXJuIG51bGwgZm9yIGZhaWxlZCBpbWFnZXMgaW5zdGVhZCBvZiB0aHJvd2luZ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFdhaXQgZm9yIGFsbCBpbWFnZXMgdG8gY29tcGxldGUgKG9yIGZhaWwpXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKGltYWdlUHJvbWlzZXMpO1xyXG5cclxuICAgICAgICAvLyBGaWx0ZXIgb3V0IG51bGwgcmVzdWx0cyAoZmFpbGVkIGltYWdlcylcclxuICAgICAgICBjb25zdCBpbWFnZXMgPSByZXN1bHRzLmZpbHRlcihpbWcgPT4gaW1nICE9PSBudWxsKTtcclxuXHJcbiAgICAgICAgLy8gSWYgd2UgZ290IE5PIGltYWdlcyBhdCBhbGwsIHRocm93IGFuIGVycm9yXHJcbiAgICAgICAgaWYgKGltYWdlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gaW1hZ2VzIGdlbmVyYXRlZC4gUGxlYXNlIHRyeSBhIGRpZmZlcmVudCBwcm9tcHQuXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gUmV0dXJuIHdoYXRldmVyIGltYWdlcyB3ZSBzdWNjZXNzZnVsbHkgZ2VuZXJhdGVkXHJcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7IGltYWdlcyB9KSwgeyBzdGF0dXM6IDIwMCwgaGVhZGVycyB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkJhY2tlbmQgR2VuZXJhdGlvbiBFcnJvcjpcIiwgZXJyb3IpO1xyXG5cclxuICAgICAgICAvLyBQcm92aWRlIG1vcmUgZGV0YWlsZWQgZXJyb3IgaW5mb3JtYXRpb24gdG8gdGhlIGZyb250ZW5kXHJcbiAgICAgICAgY29uc3QgZm9ybWF0dGVkRXJyb3IgPSBmb3JtYXRBcGlFcnJvcihlcnJvcik7XHJcblxyXG4gICAgICAgIC8vIExvZyBhZGRpdGlvbmFsIGRlYnVnZ2luZyBpbmZvcm1hdGlvblxyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJEZWJ1ZyBJbmZvOlwiKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiICAtIEFQSSBLZXkgUHJlc2VudDpcIiwgISFhcGlLZXkpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCIgIC0gTW9kZWw6XCIsIG1vZGVsKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiICAtIEVuZHBvaW50OlwiLCBwcm9jZXNzLmVudi5BUElfRU5EUE9JTlQgfHwgXCJodHRwczovL2FwaS5hNGYuY28vdjEvaW1hZ2VzL2dlbmVyYXRpb25zXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgbWVzc2FnZTogZm9ybWF0dGVkRXJyb3IsXHJcbiAgICAgICAgICAgIGRlYnVnSW5mbzoge1xyXG4gICAgICAgICAgICAgICAgYXBpS2V5UHJlc2VudDogISFhcGlLZXksXHJcbiAgICAgICAgICAgICAgICBtb2RlbDogbW9kZWwsXHJcbiAgICAgICAgICAgICAgICBlbmRwb2ludDogcHJvY2Vzcy5lbnYuQVBJX0VORFBPSU5UIHx8IFwiaHR0cHM6Ly9hcGkuYTRmLmNvL3YxL2ltYWdlcy9nZW5lcmF0aW9uc1wiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSwgeyBzdGF0dXM6IDUwMCwgaGVhZGVycyB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEhlbHBlciBmdW5jdGlvbiB3aXRoIHRpbWVvdXRcclxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hXaXRoVGltZW91dCh1cmw6IHN0cmluZywgb3B0aW9uczogYW55LCB0aW1lb3V0TXM6IG51bWJlciA9IDMwMDAwKSB7XHJcbiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xyXG4gICAgY29uc3QgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0KCksIHRpbWVvdXRNcyk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xyXG4gICAgICAgICAgICAuLi5vcHRpb25zLFxyXG4gICAgICAgICAgICBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxufVxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7O0FBbUlPLFNBQVMsZUFBZSxPQUFvQjtBQUVqRCxNQUFJLE1BQU0sU0FBUyxjQUFjO0FBQy9CLFdBQU87QUFBQSxFQUNUO0FBRUEsTUFBSSxpQkFBaUIsYUFBYSxNQUFNLFFBQVEsU0FBUyxPQUFPLEdBQUc7QUFFakUsUUFBSSxNQUFNLFFBQVEsU0FBUyxRQUFRLEdBQUc7QUFDcEMsYUFBTztBQUFBLElBQ1Q7QUFDQSxXQUFPO0FBQUEsRUFDVDtBQUVBLE1BQUksTUFBTSxTQUFTO0FBRWpCLFVBQU0sVUFBVSxNQUFNLFFB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
